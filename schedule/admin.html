<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarkSchedule - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëë</text></svg>">
    <style>
        .admin-container {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .users-table {
            background: var(--bg-card);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin-bottom: 40px;
        }

        .table-header {
            display: grid;
            grid-template-columns: 50px 2fr 1fr 200px;
            padding: 20px;
            background: var(--bg-card-light);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            color: var(--primary);
        }

        .table-row {
            display: grid;
            grid-template-columns: 50px 2fr 1fr 200px;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row:hover {
            background: var(--bg-card-light);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--text);
            text-decoration: none;
            background: var(--primary);
            padding: 12px 24px;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .back-link:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .admin-actions {
            margin: 30px 0;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .admin-actions h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .table-header,
            .table-row {
                grid-template-columns: 30px 1fr 1fr 150px;
                padding: 15px 10px;
                font-size: 14px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="notification" class="notification"></div>
    
    <div class="admin-container">
        <div class="admin-header">
            <div>
                <h1><i class="fas fa-user-shield"></i> –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
                <p style="color: var(--text-secondary); margin-top: 5px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º</p>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span id="adminName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                <button id="logoutAdminBtn" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </div>

        <div class="admin-stats">
            <div class="stat-card">
                <i class="fas fa-users" style="font-size: 24px; color: var(--primary);"></i>
                <div class="stat-value" id="usersCount">0</div>
                <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-calendar-check" style="font-size: 24px; color: var(--success);"></i>
                <div class="stat-value" id="eventsCount">0</div>
                <div class="stat-label">–°–æ–±—ã—Ç–∏–π –≤—Å–µ–≥–æ</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-bell" style="font-size: 24px; color: var(--warning);"></i>
                <div class="stat-value" id="todayEvents">0</div>
                <div class="stat-label">–°–æ–±—ã—Ç–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-user-clock" style="font-size: 24px; color: var(--info);"></i>
                <div class="stat-value" id="activeUsers">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
        </div>

        <div class="admin-actions">
            <h3><i class="fas fa-tools"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="viewAllEvents()">
                    <i class="fas fa-calendar-alt"></i> –í—Å–µ —Å–æ–±—ã—Ç–∏—è
                </button>
                <button class="btn btn-outline" onclick="exportData()">
                    <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                </button>
                <button class="btn btn-outline" onclick="clearOldEvents()">
                    <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ
                </button>
                <button class="btn btn-outline" onclick="showSystemInfo()">
                    <i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </button>
            </div>
        </div>

        <h2 style="margin-bottom: 20px;"><i class="fas fa-list"></i> –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)</h2>
        
        <div class="users-table">
            <div class="table-header">
                <div>ID</div>
                <div>–õ–æ–≥–∏–Ω</div>
                <div>–†–æ–ª—å</div>
                <div>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
            </div>
            <div id="usersList">
                <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>

        <div class="nav-buttons">
            <a href="index.html" class="back-link">
                <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
            <button class="btn btn-outline" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∞
        function checkAdminAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (!savedUser) {
                window.location.href = 'index.html';
                return null;
            }

            try {
                const user = JSON.parse(savedUser);
                if (user.username !== 'admin' && user.username !== 'Admin') {
                    window.location.href = 'index.html';
                    return null;
                }
                return user;
            } catch (e) {
                window.location.href = 'index.html';
                return null;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadAdminData() {
            const adminUser = checkAdminAuth();
            if (!adminUser) return;
            
            document.getElementById('adminName').textContent = adminUser.username;

            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersResponse = await fetch('users.json');
                const users = await usersResponse.json();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
                const scheduleResponse = await fetch('data/schedule.json');
                const schedule = await scheduleResponse.json();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage
                const tempUsers = JSON.parse(localStorage.getItem('tempUsers') || '[]');
                const allUsers = [...users, ...tempUsers];
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                document.getElementById('usersCount').textContent = allUsers.length;
                document.getElementById('eventsCount').textContent = schedule.length;
                
                const today = new Date().toISOString().split('T')[0];
                const todayEvents = schedule.filter(event => event.date === today).length;
                document.getElementById('todayEvents').textContent = todayEvents;
                
                // –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                const activeUsers = allUsers.filter(user => 
                    user.lastLogin && user.lastLogin >= weekAgo
                ).length;
                document.getElementById('activeUsers').textContent = activeUsers;
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                displayUsers(allUsers);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                
                // –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ
                const demoUsers = [
                    { id: 1, username: 'user1', email: 'user1@example.com', createdAt: '2024-01-01', role: 'user' },
                    { id: 2, username: 'user2', email: 'user2@example.com', createdAt: '2024-01-02', role: 'user' },
                    { id: 3, username: 'admin', email: 'admin@example.com', createdAt: '2024-01-01', role: 'admin' }
                ];
                document.getElementById('usersCount').textContent = '3';
                document.getElementById('eventsCount').textContent = '3';
                document.getElementById('todayEvents').textContent = '1';
                document.getElementById('activeUsers').textContent = '2';
                
                displayUsers(demoUsers);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function displayUsers(users) {
            const container = document.getElementById('usersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div>${user.id || '‚Äî'}</div>
                    <div>
                        <strong>${user.username}</strong>
                        ${user.email ? `<div style="font-size: 12px; color: var(--text-secondary);">${user.email}</div>` : ''}
                    </div>
                    <div>
                        <span style="color: ${user.role === 'admin' ? 'var(--primary)' : 'var(--text-secondary)'};">
                            ${user.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}
                        </span>
                    </div>
                    <div>${formatDate(new Date(user.createdAt || Date.now()))}</div>
                `;
                container.appendChild(row);
            });
        }

        // –î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        function viewAllEvents() {
            alert('–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.');
        }

        function exportData() {
            alert('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏–ª–∏ CSV.');
        }

        function clearOldEvents() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å —Å–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π?\n(–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –∏–º–∏—Ç–∞—Ü–∏—è)')) {
                showNotification('–°—Ç–∞—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è –æ—á–∏—â–µ–Ω—ã (–¥–µ–º–æ)', 'success');
            }
        }

        function showSystemInfo() {
            const info = `
                –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
                ‚Ä¢ –í–µ—Ä—Å–∏—è: 1.0.0
                ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${document.getElementById('usersCount').textContent}
                ‚Ä¢ –°–æ–±—ã—Ç–∏–π: ${document.getElementById('eventsCount').textContent}
                ‚Ä¢ –î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}
                ‚Ä¢ –ë—Ä–∞—É–∑–µ—Ä: ${navigator.userAgent.split(') ')[0].split('(')[1]}
            `;
            alert(info);
        }

        function refreshData() {
            loadAdminData();
            showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }

        // –í—ã—Ö–æ–¥
        document.getElementById('logoutAdminBtn').addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('authToken');
            window.location.href = 'index.html';
        });

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function formatDate(date) {
            return date.toLocaleDateString('ru-RU');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', loadAdminData);
    </script>
</body>
</html>
